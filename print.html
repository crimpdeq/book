<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Crimpdeq</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->

        <meta name="description" content="BLE dynamometer designed for finger training">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Crimpdeq</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/crimpdeq/book" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="crimpdeq"><a class="header" href="#crimpdeq">Crimpdeq</a></h1>
<p>Meet Crimpdeq, an open source alternative to <a href="https://tindeq.com/product/progressor/">Tindeq Progressor</a>, that works with <a href="https://tindeq.com/">Tindeq</a> and <a href="https://climbharder.net/">ClimbHarder</a> apps!</p>
<p>The project relies on an ESP32-C3 and uses a HX711 to get the measurements from the crane scale. For more details, see the <a href="./firmware.html">Firmware</a> chapter.</p>
<p>PCB is finished but has not been manufactured yet, hence, it's not tested.</p>
<h2 id="specs"><a class="header" href="#specs">Specs</a></h2>
<ul>
<li>Sampling Frequency: 80 Hz</li>
<li>Design Load: 1500 N (150 kg) (Full Scale)</li>
<li>Precision:
<ul>
<li><em>0.05 kg</em> between 0 and 99 kg</li>
<li><em>0.1 kg</em> between 100 kg and above</li>
</ul>
</li>
<li>Working temperature: 0ºC - 40ºC</li>
<li>Dimension: 80 mm x 90 mm x 35 mm</li>
<li>USB-C rechargeable battery</li>
</ul>
<blockquote>
<p>⚠️ <strong>Note</strong>:  Some of these specs come from the crane scale, if you use a different one, those values might change.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="making-your-own-crimpdeq"><a class="header" href="#making-your-own-crimpdeq">Making Your Own Crimpdeq</a></h1>
<ol>
<li>
<p>Required Materials</p>
<ul>
<li><a href="https://github.com/esp-rs/esp-rust-board?tab=readme-ov-file#where-to-buy">ESP32-C3-DevKit-RUST-1</a>
<ul>
<li>Other ESP32 devices can be used, but you need to figure out how to charge the battery</li>
</ul>
</li>
<li><a href="https://es.aliexpress.com/item/1005006283753220.html?spm=a2g0o.order_list.order_list_main.5.4779194d1mFZpd&amp;gatewayAdapt=glo2esp">Battery Holder</a></li>
<li><a href="https://es.aliexpress.com/item/1005007923191656.html?spm=a2g0o.order_list.order_list_main.11.4779194d1mFZpd&amp;gatewayAdapt=glo2esp">18650 Battery</a>
<ul>
<li>Other batteries might also work, as long as they can power the device</li>
</ul>
</li>
<li><a href="https://es.aliexpress.com/item/1005002719645426.html?spm=a2g0o.order_list.order_list_main.17.4779194d1mFZpd&amp;gatewayAdapt=glo2esp">Crane Scale</a> or <a href="https://www.amazon.es/dp/B08133JCM6">Amazon alternative</a>
<ul>
<li>Other crane-scales might also work</li>
</ul>
</li>
<li><a href="https://www.amazon.es/dp/B0DJX8BPQL">HX711</a></li>
</ul>
</li>
<li>
<p>Disassemble the Crane Scale
<img src="assets/crane_dissasembly.png" alt="Disassembly" /></p>
<ol>
<li>Desolder the battery connections.</li>
<li>Desolder the four wires of the load cell (<code>E-</code>, <code>S-</code>, <code>S+</code> and <code>E+</code>) from the PCB.
<img src="assets/crane_connections.png" alt="Crane connections" /></li>
<li>Unscrew and remove the PCB along with the display.</li>
</ol>
</li>
<li>
<p>Soldering Instructions</p>
<ol>
<li>
<p>Modify the HX711 Module:</p>
<ol>
<li>Update the sample rate: Most HX711 modules come with the <code>RATE</code> pin connected to <code>GND</code>, meaning that they sample at 10 Hz, if you want to sample at 80 Hz:
<img src="assets/hx711_pinout.png" alt="HX711 Pinout" />
<ol>
<li>Break the track of <code>RATE</code> pin.</li>
<li>I did this by scratching the module with a knife.</li>
<li>Verify with a multimeter that <code>GND</code> and the <code>RATE</code> pin are not connected anymore.</li>
</ol>
<ul>
<li>Make sure that you don't break the next connection.</li>
</ul>
<ol start="3">
<li>Solder the <code>RATE</code> to <code>DVDD</code> pin.</li>
<li>Verify with a multimeter.</li>
</ol>
</li>
<li>Optimize the measurements for 3.3V: Most HX711 modules come with a setup for 5V, if you want to optimize the measurements for 3.3V:
<ol>
<li>Connect, in parallel, a resistor between 20k and 27k to <code>R1</code>. <code>R1</code> is the highlighted resistor in the image:
<img src="assets/hx711_resistor.jpg" alt="Resistor to modify" /></li>
</ol>
<ul>
<li>For more information, see <a href="https://en.kohacraft.com/archives/modify-the-circuit-of-the-hx711-module-to-operate-at-3-3v-and-measure-the-weight-with-esp32.html">this blogpost</a>.</li>
<li>This step is not mandatory, but it improves the measurements.</li>
</ul>
</li>
</ol>
</li>
<li>
<p>Connect the Crane Scale to the HX711:</p>
<ul>
<li>Solder the 4 wires of the crane scale to the HX711. Usually the colors are:</li>
</ul>
<div class="table-wrapper"><table><thead><tr><th><strong>HX711 Pin</strong></th><th><strong>Load Cell Pin</strong></th><th><strong>Description</strong></th></tr></thead><tbody>
<tr><td>E+</td><td>E+ (Red)</td><td>Excitation positive (to load cell)</td></tr>
<tr><td>E-</td><td>E- (Black)</td><td>Excitation negative (to load cell)</td></tr>
<tr><td>S+</td><td>S+ (Green)</td><td>Signal positive (from load cell)</td></tr>
<tr><td>S-</td><td>S- (White)</td><td>Signal negative (from load cell)</td></tr>
</tbody></table>
</div>
<ul>
<li>Note that sometimes the <code>S</code> pins are referred as <code>A</code>.</li>
</ul>
</li>
<li>
<p>Connect the HX711 to the ESP32-C3-DevKit-RUST-1 devkit:</p>
</li>
</ol>
<div class="table-wrapper"><table><thead><tr><th><strong>HX711 Pin</strong></th><th><strong>ESP32-C3 Pin</strong></th><th><strong>Description</strong></th></tr></thead><tbody>
<tr><td>VCC</td><td>3.3V</td><td>Power supply (3.3V)</td></tr>
<tr><td>GND</td><td>GND</td><td>Ground</td></tr>
<tr><td>DT (Data)</td><td>GPIO4</td><td>Data output from HX711</td></tr>
<tr><td>SCK (Clock)</td><td>GPIO5</td><td>Clock signal for communication</td></tr>
</tbody></table>
</div>
<p><img src="assets/esp32c3_connections.png" alt="ESP32-C3 Connections" /></p>
<ol start="4">
<li>Verify all the connections with a multimeter.</li>
</ol>
</li>
<li>
<p>Adapt the Scale Case:</p>
<ol>
<li>Create space for the USB connector.
<ul>
<li>I did this by placing the devkit, marking the space that I needed with a pen and then, heating a knife and melting the case.</li>
</ul>
</li>
<li>Install the battery holder:
<ol>
<li>Glue, with some silicone, the battery holder, make sure to leave the lid for the original batteries of the scale open, as there is a hole for which you need to introduce the two wires of the battery holder.</li>
<li>Solder the positive wire (red) of the battery holder to a switch/button, to turn on/off the device, then, solder the other pin of the button/switch to the <code>B+</code> pin of ESP32-C3-DevKit-RUST-1.</li>
<li>Solder the negative wire (black) of the battery holder to the <code>B-</code> pin of the ESP32-C3-DevKit-RUST-1.</li>
</ol>
</li>
<li>Close the case:
<ol>
<li>Ensure all components are securely installed before closing the case.
<img src="assets/crane_assembly.png" alt="Assembly" /></li>
</ol>
</li>
</ol>
</li>
<li>
<p>Upload the firmware:</p>
<ol>
<li>
<p>Connect your device with a USB-C cable.</p>
</li>
<li>
<p>Pull the <code>crimpdeq</code> repository:</p>
<pre><code class="language-bash">git clone https://github.com/crimpdeq/crimpdeq-firmware
</code></pre>
<p>If you don't have git installed on your system, you can go to the green Code button and use the "Download ZIP" option.</p>
</li>
<li>
<p>Upload the firmware to your device:</p>
<ol>
<li>Download the binary from the desired <a href="https://github.com/crimpdeq/crimpdeq-firmware/releases">GitHub release</a>.</li>
<li>Open <a href="https://esp.huhn.me/">esp.huhn.me</a>.</li>
<li>Click Connect and select the serial port of your ESP board.</li>
<li>Upload your .bin file(s).</li>
<li>Click Program.</li>
</ol>
<p>See <a href="https://blog.spacehuhn.com/espwebtool">this blogpost</a> for more details.</p>
</li>
<li>
<p>Check if the calibration values work for your scale:</p>
<ol>
<li>Connect your device with ClimbHarder or Tindeq apps.</li>
<li>Use the "Live View" option.</li>
<li>Measure a known weight and verify that Crimpdeq measures the right value.
<ol>
<li>If Crimpdeq calibration is off, see the <a href="calibration.html">Calibration chapter</a>.</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="calibration"><a class="header" href="#calibration">Calibration</a></h1>
<p>This guide will help you calibrate your Crimpdeq device to ensure accurate weight measurements. The calibration process involves using a known weight to establish a reference point for the device's measurements.</p>
<ol>
<li>Download and install the nRF Connect app for your platform:
<ul>
<li><a href="https://play.google.com/store/apps/details?id=no.nordicsemi.android.mcp&amp;hl=es_419">Android</a></li>
<li><a href="https://apps.apple.com/es/app/nrf-connect-for-mobile/id1054362403">iOS</a></li>
<li><a href="https://www.nordicsemi.com/Products/Development-tools/nRF-Connect-for-Desktop/Download#infotabs">Desktop</a> (Windows, Linux, macOS)</li>
</ul>
</li>
<li>Connect nRF Connect with Crimpdeq:
<ol>
<li>Launch the nRF Connect app.</li>
<li>Navigate to the Scanner tab.</li>
<li>Look for a device named "Progressor_7125".</li>
<li>Tap "Connect".</li>
<li>Once connected, the app will display the device's services and characteristics.
<img src="./assets/Screenshot_1.png" alt="nRF Discovered" /></li>
</ol>
</li>
<li>Locate the Calibration Characteristic:
<ol>
<li>Expand the "Unknown Service" section.</li>
<li>Look for the characteristic with UUID: <code>7e4e1703-1ea6-40c9-9dcc-13d34ffead57</code>.
<img src="./assets/Screenshot_2.png" alt="Services" /></li>
</ol>
</li>
<li>Calculate the Hex Value of your known weight:
<ol>
<li>Open the <a href="https://gregstoll.com/~gregstoll/floattohex/">Floating Point to Hex Converter</a>.</li>
<li>Use "Single-precision" floating point converter.</li>
<li>Enter your known weight in the "Float value" field.</li>
<li>Click "Convert to hex".</li>
<li>Save the resulting "Hex value".
<strong>Example:</strong> For a known weight of 75.3 kg, the hex value would be <code>0x4296999a</code>.</li>
</ol>
</li>
<li>Perform Calibration:
<ol>
<li>Hang your Crimpdeq with no weight attached.</li>
<li>Send the command <code>7300000000</code> to the characteristic:
<ul>
<li>
<p>Tap the Up Arrow icon on the characteristic (<code>7e4e1703-1ea6-40c9-9dcc-13d34ffead57</code>).</p>
</li>
<li>
<p>Enter the command as shown in the screenshot.</p>
<p><img src="./assets/Screenshot_3.png" alt="Send weight" /></p>
</li>
</ul>
</li>
<li>Now, attach your known weight to the Crimpdeq.</li>
<li>Prepare the calibration command:
<ul>
<li>
<p>Take your hex value from the previous step.</p>
</li>
<li>
<p>Add <code>73</code> at the beginning.</p>
<p><strong>Example:</strong> For 75.3 kg (0x4296999a), the command would be: <code>734296999a</code>.</p>
</li>
</ul>
<blockquote>
<p>⚠️ <strong>Note</strong>:  Some scales require sending the command in grams instead of kilograms. Im still investigating this, but if after calibrating the device, the weight looks like divided by 100, try sending the command in grams.</p>
</blockquote>
</li>
<li>Send this new command to the same characteristic (<code>7e4e1703-1ea6-40c9-9dcc-13d34ffead57</code>).</li>
</ol>
</li>
</ol>
<h2 id="important-notes"><a class="header" href="#important-notes">Important Notes</a></h2>
<ul>
<li>The known weight should be greater than the maximum weight you plan to measure.</li>
<li>Make sure the device is stable and not moving when sending calibration commands.</li>
<li>The calibration process should be performed in a controlled environment.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="charging-the-battery"><a class="header" href="#charging-the-battery">Charging the Battery</a></h1>
<p>To charge your device simply:</p>
<ol>
<li>Connect a USB-C Cable:
<ul>
<li>Plug the device into a power source using a USB-C cable.</li>
<li>A red LED will turn on, indicating that the device is charging.</li>
</ul>
</li>
<li>Wait for the Charge to Complete:
<ul>
<li>Once the red LED turns off, the battery is fully charged.</li>
<li>You can now unplug the device and use it!</li>
</ul>
</li>
</ol>
<p><img src="./assets/battery_charge.png" alt="Device Charging" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="firmware"><a class="header" href="#firmware">Firmware</a></h1>
<p>The firmware application is written in asynchronous Rust (<code>no_std</code>) using <code>esp-hal</code> along with some ancillary crates.</p>
<h2 id="prerequisites"><a class="header" href="#prerequisites">Prerequisites</a></h2>
<p>To build and upload the firmware to your device, ensure you have the following installed:</p>
<ul>
<li>Rust: See <a href="https://rustup.rs/">installation</a> for details</li>
<li>The <code>stable</code> toolchain with the ESP32-C3 target architecture installed:
<pre><code class="language-bash">rustup toolchain install stable --component rust-src --target riscv32imc-unknown-none-elf
</code></pre>
</li>
<li><a href="https://probe.rs/"><code>probe-rs</code></a> installed, see <a href="https://probe.rs/docs/getting-started/installation/">instructions</a></li>
</ul>
<h2 id="how-to-build"><a class="header" href="#how-to-build">How to Build</a></h2>
<p>To build the firmware, run:</p>
<pre><code class="language-bash">cargo build --release
</code></pre>
<p>To build and upload the firmware to your device, refer to the <a href="firmware.html#build-and-flash-your-device">Build and Flash your Device</a> section.</p>
<h2 id="how-to-flash-your-device"><a class="header" href="#how-to-flash-your-device">How to Flash your Device</a></h2>
<h3 id="erase-your-device-memory"><a class="header" href="#erase-your-device-memory">Erase your Device Memory</a></h3>
<p>If you used the device for other projects, you need to erase the memory of the device:</p>
<pre><code class="language-bash">probe-rs erase
</code></pre>
<p>This only needs to be done once, after that, you should only flash the firmware without erasing the memory. Otherwise, you will lose your <a href="./calibration.html">calibration values</a>.</p>
<h3 id="build-and-flash-your-device"><a class="header" href="#build-and-flash-your-device">Build and Flash your Device</a></h3>
<p>Since we've set a <a href="https://doc.rust-lang.org/cargo/reference/config.html#targettriplerunner">custom runner</a> in the <code>.cargo/config.toml</code>, you can build and upload the resulting binary to your target using:</p>
<pre><code class="language-bash">cargo run --release
</code></pre>
<p>This will also open a serial monitor, allowing you to view log messages in real time.</p>
<p>To modify the <a href="https://defmt.ferrous-systems.com/filtering">log level</a>, update the <code>DEFMT_LOG</code> value in <code>.cargo/config.toml</code> or set it when running the command:</p>
<pre><code class="language-bash">DEFMT_LOG=debug cargo run --release
</code></pre>
<blockquote>
<p>⚠️ <strong>Note</strong>:  If you're using a different DevKit that doesn't include USB-Serial-JTAG, you'll need to flash the device via UART. This requires updating the custom runner in <code>.cargo/config.toml</code> and using <a href="https://github.com/esp-rs/espflash/tree/main/espflash#cargo-runner"><code>espflash</code></a> instead of <code>probe-rs</code>.</p>
</blockquote>
<h3 id="flashing-from-your-browser"><a class="header" href="#flashing-from-your-browser">Flashing From Your Browser</a></h3>
<p>This method does not require any of the <a href="firmware.html#prerequisites">Prerequisites</a>, but also it does not allow modifying the code. Instead, it only allows flashing a <a href="https://github.com/crimpdeq/crimpdeq-firmware/releases">released firmware version</a>.</p>
<p>To flash the released binary using your browser:</p>
<ol>
<li>Download the binary from the desired GitHub release</li>
<li>Open <a href="https://adafruit.github.io/Adafruit_WebSerial_ESPTool/">Adafruit ESPTool</a></li>
<li>Click Connect and select the serial port of your ESP board (should be named <code>USB/JTAG serial debug unit...</code>)</li>
<li>Upload your .bin file(s) at offset 0x<code>10000</code></li>
<li>Click Program
<img src="./assets/esptool.png" alt="Flashing with ESPTool" /></li>
</ol>
<h2 id="code-structure"><a class="header" href="#code-structure">Code Structure</a></h2>
<h3 id="hx711"><a class="header" href="#hx711"><code>hx711</code></a></h3>
<p>This module implements the load cell functionality, it's an <code>async</code> version of the <a href="https://crates.io/crates/loadcell">loadcell</a> crate with additional modifications.</p>
<h3 id="ble"><a class="header" href="#ble"><code>ble</code></a></h3>
<p>This module implements the Bluetooth Low Energy (BLE) functionality:</p>
<ul>
<li>Defines the GATT server and services</li>
<li>Handles advertising and connections</li>
<li>Defines the Progressor service with data point and control point characteristics</li>
</ul>
<h3 id="progressor"><a class="header" href="#progressor"><code>progressor</code></a></h3>
<p>The <code>progressor</code> module implements the <a href="https://tindeq.com/progressor_api/">Tindeq API</a>, enabling BLE (Bluetooth Low Energy) communication between the ESP32-C3 and a smartphone.</p>
<h2 id="main-tasks"><a class="header" href="#main-tasks">Main Tasks</a></h2>
<p>The <code>main.rs</code> file defines several asynchronous tasks that run concurrently:</p>
<ul>
<li><code>measurement_task</code>:
<ul>
<li>Initializes the load cell</li>
<li>Handles taring and reading measurements from the sensor.</li>
</ul>
</li>
<li><code>ble_task</code>:
<ul>
<li>This is a background task that is required to run forever alongside any other BLE tasks.</li>
</ul>
</li>
<li><code>gatt_events_task</code>:
<ul>
<li>Processes GATT events like control point writes</li>
</ul>
</li>
<li><code>data_processing_task</code>:
<ul>
<li>Handles sending notifications with data points</li>
</ul>
</li>
</ul>
<p>Communication between tasks occurs via a <a href="https://docs.embassy.dev/embassy-sync/git/default/channel/struct.Channel.html"><code>Channel</code></a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pcb"><a class="header" href="#pcb">PCB</a></h1>
<p>The PCB design is located in the <code>hardware</code> folder and was created using KiCad. It is a two-layer layout based on the Rust ESP Board. This design removes unused sensors from the original board and adds the necessary components for this project.</p>
<h2 id="status"><a class="header" href="#status">Status</a></h2>
<p>Currently, the PCB has not yet been manufactured, so it remains untested.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
